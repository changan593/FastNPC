# 测试用例标签页右侧面板改进

## 改进日期
2025-10-19

## 问题背景

用户反馈：测试用例标签页的右下角测试用例列表（执行历史）太多不方便管理，建议只细化到角色和群聊粒度。

## 改进方案

### 改进前
```
左侧：测试分类
中间：测试用例详情
右侧：执行历史（显示该测试用例的所有执行记录）
```

**问题**：
- 一个测试用例可能被执行多次，执行历史会很长
- 执行历史应该在"测试执行"标签页查看更合理
- 右侧面板没有充分利用，不便于管理同一角色/群聊的多个测试场景

### 改进后
```
左侧：测试分类
中间：测试用例详情
右侧：相关测试用例（同一角色/群聊的其他测试用例）
```

**优势**：
- ✅ 聚焦测试内容管理，不显示执行历史
- ✅ 显示同一个角色/群聊的其他测试用例
- ✅ 支持快速切换到相关测试
- ✅ 职责更清晰：测试用例标签页管理测试内容，测试执行标签页查看执行历史

## 实施内容

### 修改的文件
`web/fastnpc-web/src/components/modals/PromptManagementModal.tsx` (第1369-1577行)

### UI组件

#### 1. 目标信息卡片
显示当前测试用例的目标信息：
- 目标类型图标（👤 角色 / 👥 群聊）
- 角色/群聊名称（从测试用例名称中提取）
- 目标ID和分类

样式：渐变紫色背景，白色文字

#### 2. 相关测试用例列表
**标题栏**：
- "同目标的其他测试"
- 数量徽章（蓝色背景）

**测试用例卡片**：
- 测试用例名称 + "激活"徽章（如果已激活）
- 测试描述
- 版本号 + 创建日期

**交互效果**：
- 点击可切换测试用例
- Hover 时边框变色、阴影加深、轻微上移动画

**空状态**：
- 显示 📝 图标
- "暂无其他测试用例"提示
- 说明文字：同一个角色/群聊可以创建多个测试场景

#### 3. 提示信息
蓝色背景的提示框：
- 💡 点击测试用例可快速切换
- 前往"测试执行"标签页运行测试并查看执行历史

## 功能特性

### 1. 智能过滤
```typescript
testCases.filter(tc => 
  tc.target_type === selectedTestCase.target_type &&
  tc.target_id === selectedTestCase.target_id &&
  tc.id !== selectedTestCase.id
)
```

只显示：
- 相同目标类型（character/group）
- 相同目标ID
- 排除当前选中的测试用例

### 2. 名称提取
```typescript
const parts = selectedTestCase.name.split('-')
return parts[0] || selectedTestCase.name
```

从测试用例名称中智能提取角色/群聊名称（通常测试用例名称格式为：`角色名-测试场景`）

### 3. 快速切换
点击任意相关测试用例卡片，立即切换到该测试用例，无需返回左侧列表重新选择。

## 用户体验提升

### 场景示例

**例如：特朗普角色有3个测试用例**
1. 特朗普-政治观点测试1
2. 特朗普-外交政策测试2
3. 特朗普-经济政策测试3

**改进前**：
- 选择测试1，右侧显示测试1的10条执行历史
- 要查看测试2，需要返回左侧列表重新选择

**改进后**：
- 选择测试1，右侧显示"特朗普"的其他2个测试
- 直接点击测试2卡片即可切换，快速对比不同测试场景

### 职责分离

**测试用例标签页**（当前页）：
- 🎯 专注：测试内容的组织和管理
- 📝 功能：编辑测试消息、配置参数
- 🔗 导航：快速切换同target的测试

**测试执行标签页**：
- ▶️ 专注：运行测试和查看结果
- 📊 功能：批量执行、结果展示
- 📜 历史：查看执行记录和评估详情

## 代码统计

- 删除代码：约110行（执行历史显示）
- 新增代码：约210行（相关测试用例显示）
- 净增加：约100行

## 验证清单

- [x] 右侧显示"相关测试用例"标题
- [x] 目标信息卡片显示正确
- [x] 正确过滤同target的其他测试用例
- [x] 数量徽章显示正确
- [x] 测试用例卡片可点击切换
- [x] Hover效果正常
- [x] 空状态显示正确
- [x] 提示信息显示正确
- [x] 激活徽章显示正确
- [x] 无linter错误

## 后续优化建议

### 短期
- [ ] 添加"创建新测试"按钮，快速为当前角色/群聊创建新测试
- [ ] 支持测试用例排序（按创建时间、名称、版本）
- [ ] 添加搜索框，快速过滤测试用例

### 中期
- [ ] 支持拖拽排序
- [ ] 支持批量操作（批量删除、批量激活）
- [ ] 添加测试用例标签系统（如：基础测试、压力测试、边界测试）

### 长期
- [ ] 测试用例依赖关系可视化
- [ ] 测试覆盖率统计
- [ ] 自动生成测试报告

## 相关文档
- [测试执行标签页实现](./TEST_EXECUTION_IMPLEMENTATION.md)
- [功能提示词标签页Bug修复](./BUGFIX_PROMPT_TAB.md)

## 用户反馈

原始反馈：
> "测试用例标签页的右下角测试用例列表应该只细化到角色和群聊粒度，比如说某个角色的第一条测试用例和第二条测试用例，这个的管理应该是主界面这边进行管理，你觉得呢，不然右下角测试用例列表太多了，不方便管理"

回应：
✅ 完全采纳，已按照建议实施改进

